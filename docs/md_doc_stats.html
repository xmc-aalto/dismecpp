<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DiSMEC++: Statistics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DiSMEC++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doc_stats.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Statistics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>stats</code> classes and functions allow us to collect statistics about the internal of the learning / optimization procedure. There are three main goals for this code, which unfortunately are at odds with one another:</p><ul>
<li><b>Non-intrusiveness</b>: The statistics gathering code should require as little modifications to the actual computation code as possible.</li>
<li><b>Speed</b>: While statistics gathering will come with some unavoidable overhead, we want to have it as fast as possible. Especially if it has been decided at runtime that a statistics is not required, the stats code should have no discernible effect on running time.</li>
<li><b>Versatility</b>: Since we don't know beforehand which statistics are needed for an experiment, we want it so that this can be configured at runtime. A change in the desired statistics should (usually) require no modifications to the code and no recompiling.</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Recording implementation</h2>
<p>In order to achieve speedy data gathering, we need to do the statistics collection in each thread separately and independently, and only combine data at the end. This means that instances of the types which get replicated per-thread, and which are expected to gather statistics (e.g. the minimizer and objective, initial condition and post processors) contain a statistics gatherer. While this requires adding an additional data member to the classes, it is less intrusive than requiring to pass some statistics gatherer as an argument of any function which might want to collect statistics. This also allows each of these classes to define numerical indices (needed for speed) for the different statistics that are independent of each other, so there is no coupling between the different statistics gathering modules.</p>
<p>For the end user, the statistics need to be accessible by a (human-readable) name, but in the actual code a string-based lookup would induce a performance penalty. Therefore, we require that each statistics be declared before use in a way that assigned a unique integer id to the name. The recording code itself can then use this ID and the statistics can be found by a (quick) array lookup. Since each thread-local object (Minimizer, Objective, ...) which gathers statistics has its own StatisticsCollection instance, the IDs only need to be unique within each type.</p>
<p>To reduce the necessary boilerplate code a base class <code><a class="el" href="classdismec_1_1stats_1_1Tracked.html" title="A base class to be used for all types that implement some for of statistics tracking.">dismec::stats::Tracked</a></code> is provided from which the statistics gathering objects can be derived. This wrapper is coded in such a way that it does not actually include the <code><a class="el" href="classdismec_1_1stats_1_1StatisticsCollection.html" title="This class manages a collection of named Statistics objects.">dismec::stats::StatisticsCollection</a></code> as a header dependency (non-intrusiveness), but still allows all performance-critical calls that will be relayed to the collection to be inlined. This is achieved by making these calls dependent on a dummy template parameter, so a definition of <code><a class="el" href="classdismec_1_1stats_1_1StatisticsCollection.html" title="This class manages a collection of named Statistics objects.">dismec::stats::StatisticsCollection</a></code> only needs to be present at the call site.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Tags</h2>
<p>In many cases we want to be able to track ancillary information attached to the main data that is recorded, e.g. in which iteration of the optimization the recording happened. This is managed by tags. Contrary to the recorded statistics, tags are persistent values that remain until overwritten. They are also associated with a name (for human setup / output) and an ID (for fast updating).</p>
<p>Internally, a tag is implemented as a <code>std::shared_ptr</code> to its data. In this way, any statistics that wants to correlate its data with the tag can request (based on the name) this pointer at the beginning of the setup phase, and during recording only has to dereference the pointer to read the value. The reason why we don't use the same system (shared ptr that is written to) also to update the tags from user code is that this would require each recording class to store these shared pointers, i.e. the possible tags would leak into the class header, which we want to avoid.</p>
<p>A particularly tricky situation arises if the data we want to use as a tag is not available to the object that records the statistics. This happens for example if we want to correlate a statistics in the objective function with the iteration in the optimizer. That means the tag is not registered in the same object as the statistics that uses it. For that reason, we can also register <em>read-only</em> tags to collections, which are tags of other collections which can be read by the statistics of this collection. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
