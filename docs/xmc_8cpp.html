<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DiSMEC++: src/io/xmc.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DiSMEC++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('xmc_8cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">xmc.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="xmc_8h_source.html">io/xmc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="common_8h_source.html">io/common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="data_8h_source.html">data/data.h</a>&quot;</code><br />
<code>#include &lt;fstream&gt;</code><br />
<code>#include &quot;spdlog/spdlog.h&quot;</code><br />
<code>#include &quot;spdlog/fmt/fmt.h&quot;</code><br />
<code>#include &quot;spdlog/stopwatch.h&quot;</code><br />
<code>#include &quot;doctest.h&quot;</code><br />
</div>
<p><a href="xmc_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structanonymous__namespace_02xmc_8cpp_03_1_1XMCHeader.html">anonymous_namespace{xmc.cpp}::XMCHeader</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collects the data from the header of an xmc file <a class="el" href="xmc-data.html">XMC data format</a>.  <a href="structanonymous__namespace_02xmc_8cpp_03_1_1XMCHeader.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceanonymous__namespace_02xmc_8cpp_03"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02xmc_8cpp_03.html">anonymous_namespace{xmc.cpp}</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4e6b29d5935791136903c9c0175475d2"><td class="memItemLeft" align="right" valign="top">XMCHeader&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02xmc_8cpp_03.html#a4e6b29d5935791136903c9c0175475d2">anonymous_namespace{xmc.cpp}::parse_xmc_header</a> (const std::string &amp;content)</td></tr>
<tr class="memdesc:a4e6b29d5935791136903c9c0175475d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses the header (number of examples, features, labels) of an XMC dataset file.  <a href="namespaceanonymous__namespace_02xmc_8cpp_03.html#a4e6b29d5935791136903c9c0175475d2">More...</a><br /></td></tr>
<tr class="separator:a4e6b29d5935791136903c9c0175475d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0054012b726b5f8577df49f29b2b445"><td class="memItemLeft" align="right" valign="top">std::vector&lt; long &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02xmc_8cpp_03.html#aa0054012b726b5f8577df49f29b2b445">anonymous_namespace{xmc.cpp}::count_features_per_example</a> (std::istream &amp;source, std::size_t num_examples=100 '000)</td></tr>
<tr class="memdesc:aa0054012b726b5f8577df49f29b2b445"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extracts number of nonzero features for each instance.  <a href="namespaceanonymous__namespace_02xmc_8cpp_03.html#aa0054012b726b5f8577df49f29b2b445">More...</a><br /></td></tr>
<tr class="separator:aa0054012b726b5f8577df49f29b2b445"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad15daed127e6a2f21b4243a65522f245"><td class="memTemplParams" colspan="2">template&lt;class F &gt; </td></tr>
<tr class="memitem:ad15daed127e6a2f21b4243a65522f245"><td class="memTemplItemLeft" align="right" valign="top">const char *&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02xmc_8cpp_03.html#ad15daed127e6a2f21b4243a65522f245">anonymous_namespace{xmc.cpp}::parse_labels</a> (const char *line, F &amp;&amp;callback)</td></tr>
<tr class="memdesc:ad15daed127e6a2f21b4243a65522f245"><td class="mdescLeft">&#160;</td><td class="mdescRight">parses the labels part of a xmc dataset line.  <a href="namespaceanonymous__namespace_02xmc_8cpp_03.html#ad15daed127e6a2f21b4243a65522f245">More...</a><br /></td></tr>
<tr class="separator:ad15daed127e6a2f21b4243a65522f245"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4991673711a392ffe36360322f9ee69"><td class="memTemplParams" colspan="2">template&lt;long IndexOffset&gt; </td></tr>
<tr class="memitem:ad4991673711a392ffe36360322f9ee69"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02xmc_8cpp_03.html#ad4991673711a392ffe36360322f9ee69">anonymous_namespace{xmc.cpp}::read_into_buffers</a> (std::istream &amp;source, <a class="el" href="namespacedismec.html#a87f34b52ec3d9133536bb78ae10bcb0d">SparseFeatures</a> &amp;feature_buffer, std::vector&lt; std::vector&lt; long &gt;&gt; &amp;label_buffer)</td></tr>
<tr class="memdesc:ad4991673711a392ffe36360322f9ee69"><td class="mdescLeft">&#160;</td><td class="mdescRight">iterates over the lines in <code>source</code> and puts the corresponding features and labels into the given buffers.  <a href="namespaceanonymous__namespace_02xmc_8cpp_03.html#ad4991673711a392ffe36360322f9ee69">More...</a><br /></td></tr>
<tr class="separator:ad4991673711a392ffe36360322f9ee69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d9b47982812a5026bbd0ff5f98959ef"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02xmc_8cpp_03.html#a6d9b47982812a5026bbd0ff5f98959ef">anonymous_namespace{xmc.cpp}::write_label_list</a> (std::ostream &amp;stream, const std::vector&lt; int &gt; &amp;labels)</td></tr>
<tr class="separator:a6d9b47982812a5026bbd0ff5f98959ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac55a46e1b16164035d569b7ffc8c8299"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xmc_8cpp.html#ac55a46e1b16164035d569b7ffc8c8299">TEST_CASE</a> (&quot;parse valid header&quot;)</td></tr>
<tr class="separator:ac55a46e1b16164035d569b7ffc8c8299"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4528147290f332ad2fa61e9e8868bf46"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xmc_8cpp.html#a4528147290f332ad2fa61e9e8868bf46">TEST_CASE</a> (&quot;parse invalid header&quot;)</td></tr>
<tr class="separator:a4528147290f332ad2fa61e9e8868bf46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8150352399408596cd2336f8eced13e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xmc_8cpp.html#ae8150352399408596cd2336f8eced13e">TEST_CASE</a> (&quot;count features&quot;)</td></tr>
<tr class="separator:ae8150352399408596cd2336f8eced13e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4d1d486c347567d18bd4de087f2857f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xmc_8cpp.html#af4d1d486c347567d18bd4de087f2857f">TEST_CASE</a> (&quot;parse labels errors&quot;)</td></tr>
<tr class="separator:af4d1d486c347567d18bd4de087f2857f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34025d09138d253a9bb251ab923f0a99"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xmc_8cpp.html#a34025d09138d253a9bb251ab923f0a99">TEST_CASE</a> (&quot;parse labels&quot;)</td></tr>
<tr class="separator:a34025d09138d253a9bb251ab923f0a99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedc202f4829c763e08ef927b4e3df096"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xmc_8cpp.html#aedc202f4829c763e08ef927b4e3df096">TEST_CASE</a> (&quot;read into buffers bounds checks&quot;)</td></tr>
<tr class="separator:aedc202f4829c763e08ef927b4e3df096"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ae8150352399408596cd2336f8eced13e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8150352399408596cd2336f8eced13e">&#9670;&nbsp;</a></span>TEST_CASE() <span class="overload">[1/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">&quot;count features&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="test"><dt><b><a class="el" href="test.html#_test000017">Test:</a></b></dt><dd>Checks that the number of features are counted correctly. Since feature counting is only a very simple approximation, that assumes correctly formatted input data, the only thing we test here is that 1) the counts are correct and 2) empty lines and comments are skipped as they are supposed to. </dd></dl>

<p class="definition">Definition at line <a class="el" href="xmc_8cpp_source.html#l00376">376</a> of file <a class="el" href="xmc_8cpp_source.html">xmc.cpp</a>.</p>

<p class="reference">References <a class="el" href="xmc_8cpp_source.html#l00075">anonymous_namespace{xmc.cpp}::count_features_per_example()</a>.</p>

</div>
</div>
<a id="a4528147290f332ad2fa61e9e8868bf46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4528147290f332ad2fa61e9e8868bf46">&#9670;&nbsp;</a></span>TEST_CASE() <span class="overload">[2/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">&quot;parse invalid header&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="test"><dt><b><a class="el" href="test.html#_test000016">Test:</a></b></dt><dd>Check that invalid XMC headers are causing an exception. The headers are invalid if either the number of data does not match, of if any of the supplied counts are non-positive. </dd></dl>

<p class="definition">Definition at line <a class="el" href="xmc_8cpp_source.html#l00357">357</a> of file <a class="el" href="xmc_8cpp_source.html">xmc.cpp</a>.</p>

<p class="reference">References <a class="el" href="xmc_8cpp_source.html#l00031">anonymous_namespace{xmc.cpp}::parse_xmc_header()</a>.</p>

</div>
</div>
<a id="af4d1d486c347567d18bd4de087f2857f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4d1d486c347567d18bd4de087f2857f">&#9670;&nbsp;</a></span>TEST_CASE() <span class="overload">[3/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">&quot;parse labels errors&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="test"><dt><b><a class="el" href="test.html#_test000018">Test:</a></b></dt><dd>This test checks that XMC label parsing of incorrectly formatted lines results in errors. Note that some formatting problems (such as a space before a comma: <code>5 ,1 10:3.0</code>) are perfectly legal from a label parsing point of view, but will result in an error when the subsequent feature parsing happens. We currently check the following error conditions:<ul>
<li>trailing comma</li>
<li>not-a-number</li>
<li>not an integer</li>
<li>wrong separator between labels </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="xmc_8cpp_source.html#l00421">421</a> of file <a class="el" href="xmc_8cpp_source.html">xmc.cpp</a>.</p>

<p class="reference">References <a class="el" href="xmc_8cpp_source.html#l00114">anonymous_namespace{xmc.cpp}::parse_labels()</a>.</p>

</div>
</div>
<a id="a34025d09138d253a9bb251ab923f0a99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34025d09138d253a9bb251ab923f0a99">&#9670;&nbsp;</a></span>TEST_CASE() <span class="overload">[4/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">&quot;parse labels&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="test"><dt><b><a class="el" href="test.html#_test000019">Test:</a></b></dt><dd>This test checks that XMC label parsing of correctly formatted lines gives the desired results. We check that whitespace is robust to space/tab, and that the empty labels situation is correctly recognised. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>we should also check that the returned pointer is valid. </dd></dl>

<p class="definition">Definition at line <a class="el" href="xmc_8cpp_source.html#l00443">443</a> of file <a class="el" href="xmc_8cpp_source.html">xmc.cpp</a>.</p>

<p class="reference">References <a class="el" href="xmc_8cpp_source.html#l00114">anonymous_namespace{xmc.cpp}::parse_labels()</a>.</p>

</div>
</div>
<a id="ac55a46e1b16164035d569b7ffc8c8299"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac55a46e1b16164035d569b7ffc8c8299">&#9670;&nbsp;</a></span>TEST_CASE() <span class="overload">[5/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">&quot;parse valid header&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="test"><dt><b><a class="el" href="test.html#_test000015">Test:</a></b></dt><dd>Checks that valid XMC headers are parsed correctly </dd></dl>

<p class="definition">Definition at line <a class="el" href="xmc_8cpp_source.html#l00337">337</a> of file <a class="el" href="xmc_8cpp_source.html">xmc.cpp</a>.</p>

<p class="reference">References <a class="el" href="xmc_8cpp_source.html#l00031">anonymous_namespace{xmc.cpp}::parse_xmc_header()</a>.</p>

</div>
</div>
<a id="aedc202f4829c763e08ef927b4e3df096"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedc202f4829c763e08ef927b4e3df096">&#9670;&nbsp;</a></span>TEST_CASE() <span class="overload">[6/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">&quot;read into buffers bounds checks&quot;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="test"><dt><b><a class="el" href="test.html#_test000020">Test:</a></b></dt><dd>This test verifies that <code>read_into_buffers</code> performs correct bounds checking for its features, labels and examples. We check that both overflow (for examples, labels, features) and underflow (for labels, features) are detected, and that these take into account whether indexing is one-based or zero-based </dd></dl>

<p class="definition">Definition at line <a class="el" href="xmc_8cpp_source.html#l00488">488</a> of file <a class="el" href="xmc_8cpp_source.html">xmc.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c184e51c84f2c3f0345bbc8a0d75d3e1.html">io</a></li><li class="navelem"><a class="el" href="xmc_8cpp.html">xmc.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
