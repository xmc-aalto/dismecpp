<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DiSMEC++: src/io/model-io.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DiSMEC++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('model-io_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">model-io.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="model-io_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) 2021, Aalto University, developed by Erik Schultheis</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// SPDX-License-Identifier: MIT</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="model-io_8h.html">io/model-io.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">io/common.h</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="weights_8h.html">io/weights.h</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dense_8h.html">model/dense.h</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sparse_8h.html">model/sparse.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="submodel_8h.html">model/submodel.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;spdlog/spdlog.h&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;spdlog/fmt/fmt.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;spdlog/fmt/chrono.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;nlohmann/json.hpp&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="numa_8h.html">parallel/numa.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="model-io_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">   22</a></span>&#160;<span class="keyword">using</span> <a class="code" href="model-io_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a> = <a class="code" href="model-io_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">nlohmann::json</a>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacedismec.html">dismec</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacedismec_1_1io_1_1model.html">dismec::io::model</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02model-io_8cpp_03.html">   26</a></span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#aaf31c2405cf93b23a7005de8a4860266">   28</a></span>&#160;    <span class="keyword">const</span> std::array&lt;const char*, 4&gt; <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#aaf31c2405cf93b23a7005de8a4860266">weight_format_names</a> = {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            <span class="stringliteral">&quot;DenseTXT&quot;</span>, <span class="stringliteral">&quot;SparseTXT&quot;</span>, <span class="stringliteral">&quot;DenseNPY&quot;</span>, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    };</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#abb30b1d03973f7fde16bdf04b0708ca8">   33</a></span>&#160;    <span class="keyword">const</span> std::array&lt;bool, 4&gt; <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#abb30b1d03973f7fde16bdf04b0708ca8">weight_format_sparsity</a> = {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    };</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a9225d86bc2ef9e003da72793de069491">   43</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a9225d86bc2ef9e003da72793de069491">save_weights_dispatch</a>(std::ostream&amp; target, <span class="keyword">const</span> <a class="code" href="classdismec_1_1model_1_1Model.html">Model</a>&amp; model, <a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html">SaveOption</a>&amp; options) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        target.precision(options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#ab106728c3c55992c486e8242b8f838fa">Precision</a>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">switch</span> (options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#a398c2cc7bb2ab5b7776df266f77ca5e2">Format</a>) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a6d5ba618729df78c44be2ffc850fa281">WeightFormat::DENSE_TXT</a>:</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                <a class="code" href="namespacedismec_1_1io_1_1model.html#abfdbf4d49bb96037d6b6df2ce7909191">save_dense_weights_txt</a>(target, model);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a9e31d6cbca343a71693a681e7eb427ec">WeightFormat::SPARSE_TXT</a>:</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                <a class="code" href="namespacedismec_1_1io_1_1model.html#a9d15f7ead589f5d5153b1fe92e257aef">save_as_sparse_weights_txt</a>(target, model, options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#aa79275e4cea9cb62b3ad06c3ab89859f">Culling</a>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794af0c60767b8402acf1f1bd256c0fa1e9e">WeightFormat::DENSE_NPY</a>:</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                <a class="code" href="namespacedismec_1_1io_1_1model.html#a4d86304e254fb573e16ec8c846ee3a41">save_dense_weights_npy</a>(*target.rdbuf(), model);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794ab901a11d23ec68072265b7c78e650e50">WeightFormat::NULL_FORMAT</a>:</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        }</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a98c539a9fad358a4456c8a92bbb2cd12">   67</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a98c539a9fad358a4456c8a92bbb2cd12">read_weights_dispatch</a>(std::istream&amp; source, <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794">WeightFormat</a> format, <a class="code" href="classdismec_1_1model_1_1Model.html">Model</a>&amp; model) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">switch</span> (format) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a6d5ba618729df78c44be2ffc850fa281">WeightFormat::DENSE_TXT</a>:</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <a class="code" href="namespacedismec_1_1io_1_1model.html#ab23fe02efae025836a76b0ee57ed4b60">load_dense_weights_txt</a>(source, model);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a9e31d6cbca343a71693a681e7eb427ec">WeightFormat::SPARSE_TXT</a>:</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                <a class="code" href="namespacedismec_1_1io_1_1model.html#a09c54fa7d58827f37b2e737624a99e40">load_sparse_weights_txt</a>(source, model);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794af0c60767b8402acf1f1bd256c0fa1e9e">WeightFormat::DENSE_NPY</a>:</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <a class="code" href="namespacedismec_1_1io_1_1model.html#acb349249b869b7b98cc15bd1c443e6a3">load_dense_weights_npy</a>(*source.rdbuf(), model);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Invalid format&quot;</span>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="namespacedismec_1_1io_1_1model.html#a40d9a974c3183de5a571bd95f73fb73d">   84</a></span>&#160;<a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794">WeightFormat</a> <a class="code" href="namespacedismec_1_1io_1_1model.html#a40d9a974c3183de5a571bd95f73fb73d">io::model::parse_weights_format</a>(std::string_view weight_format) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>* format_index = std::find(begin(<a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#aaf31c2405cf93b23a7005de8a4860266">weight_format_names</a>), end(<a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#aaf31c2405cf93b23a7005de8a4860266">weight_format_names</a>), weight_format);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794">WeightFormat</a><span class="keyword">&gt;</span>(std::distance(begin(<a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#aaf31c2405cf93b23a7005de8a4860266">weight_format_names</a>), format_index));</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="namespacedismec_1_1io_1_1model.html#aaa4366a1f56e499dba21a786ca9ed6cf">   89</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="namespacedismec_1_1io_1_1model.html#aaa4366a1f56e499dba21a786ca9ed6cf">io::model::to_string</a>(<a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794">WeightFormat</a> format) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#aaf31c2405cf93b23a7005de8a4860266">weight_format_names</a>.at(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(format));</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a1a5062677d465c46092f06da27d618a6">   93</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a1a5062677d465c46092f06da27d618a6">PartialModelIO::read_metadata_file</a>(<span class="keyword">const</span> path&amp; meta_file) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    std::fstream source(meta_file, std::fstream::in);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span>(!source.is_open()) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(fmt::format(<span class="stringliteral">&quot;Could not open model metadata file &#39;{}&#39;&quot;</span>, meta_file.c_str()));</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// read and parse the metadata</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    std::string s;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    getline (source, s,  <span class="charliteral">&#39;\0&#39;</span>);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="model-io_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a> meta = json::parse(s);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae69f380355fba9530d157b0969226f21">m_NumFeatures</a> = meta[<span class="stringliteral">&quot;num-features&quot;</span>];</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a> = meta[<span class="stringliteral">&quot;num-labels&quot;</span>];</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; weight_file : meta[<span class="stringliteral">&quot;files&quot;</span>]) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> first = <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{weight_file[<span class="stringliteral">&quot;first&quot;</span>]};</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordtype">long</span> count = weight_file[<span class="stringliteral">&quot;count&quot;</span>];</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        std::string weight_format = weight_file[<span class="stringliteral">&quot;weight-format&quot;</span>];</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keyword">auto</span> format = <a class="code" href="namespacedismec_1_1io_1_1model.html#a40d9a974c3183de5a571bd95f73fb73d">parse_weights_format</a>(weight_format);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>.push_back(<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>{first, count, weight_file[<span class="stringliteral">&quot;file&quot;</span>], format});</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a0589c23b683b3d084a81cc5121a2994f">  116</a></span>&#160;<span class="keyword">auto</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a0589c23b683b3d084a81cc5121a2994f">io::model::PartialModelIO::label_lower_bound</a>(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> pos) <span class="keyword">const</span> -&gt; std::vector&lt;WeightFileEntry&gt;::const_iterator {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span> std::lower_bound(begin(m_SubFiles), end(m_SubFiles), pos,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                            [](<span class="keyword">const</span> <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>&amp; s, <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> val) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                <span class="keywordflow">return</span> s.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">First</a> &lt; val;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                            });</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a7df515ff71cf7cb781202cca12c61cde">  123</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a7df515ff71cf7cb781202cca12c61cde">io::model::PartialModelIO::insert_sub_file</a>(<span class="keyword">const</span> <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>&amp; sub) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keyword">auto</span> last_label = [](<span class="keyword">const</span> <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>&amp; sf) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">return</span> sf.First + (sf.Count - 1);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    };</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">auto</span> insert_pos = label_lower_bound(sub.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">First</a>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// now, insert pos points to the element that will end up following the newly inserted element.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// check that there is no overlap between partial models</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// if there is a successor element</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span>(insert_pos != m_SubFiles.end()) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span>(last_label(sub) &gt;= insert_pos-&gt;First) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordflow">throw</span> std::logic_error(fmt::format(<span class="stringliteral">&quot;Overlap detected! Partial model in file {} stores weights {}-{}, &quot;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                               <span class="stringliteral">&quot;partial model in file {} stores {}-{}&quot;</span>, insert_pos-&gt;FileName,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                               insert_pos-&gt;First.to_index(), last_label(*insert_pos).to_index(), sub.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a8b652340340a136a8d8fef015f0043bc">FileName</a>,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                               sub.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">First</a>.<a class="code" href="classdismec_1_1opaque__int__type.html#a232ac208e73d81fd570c9e3f94c8207b">to_index</a>(), last_label(sub).to_index()));</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// if there is a previous element, also check that</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span>(insert_pos != m_SubFiles.begin()) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; prev_el = *std::prev(insert_pos);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">if</span>(last_label(prev_el) &gt;= sub.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">First</a>) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="keywordflow">throw</span> std::logic_error(fmt::format(<span class="stringliteral">&quot;Overlap detected! Partial model in file {} stores weights {}-{}, &quot;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                               <span class="stringliteral">&quot;partial model in file {} stores {}-{}&quot;</span>, prev_el.FileName, prev_el.First.to_index(),</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                               last_label(prev_el).to_index(), sub.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a8b652340340a136a8d8fef015f0043bc">FileName</a>, sub.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">First</a>.<a class="code" href="classdismec_1_1opaque__int__type.html#a232ac208e73d81fd570c9e3f94c8207b">to_index</a>(), last_label(sub).to_index()));</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    m_SubFiles.insert(insert_pos, sub);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">// -------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">//                      Partial Model Saver</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">// -------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a2756f72407e4d8731fbe758729cc0ddd">  160</a></span>&#160;<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a2756f72407e4d8731fbe758729cc0ddd">PartialModelSaver::PartialModelSaver</a>(path target_file, <a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html">SaveOption</a> options, <span class="keywordtype">bool</span> load_partial) :</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    m_Options(options), m_MetaFileName(std::move(target_file)) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span>(load_partial) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a1a5062677d465c46092f06da27d618a6">read_metadata_file</a>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// check validity of save location</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>.parent_path().empty() &amp;&amp; !std::filesystem::exists(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>.parent_path())) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(fmt::format(<span class="stringliteral">&quot;Cannot save to &#39;{}&#39; because directory does not exist.&quot;</span>,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                             <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>.c_str()));</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">  172</a></span>&#160;std::future&lt;WeightFileEntry&gt; <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">PartialModelSaver::add_model</a>(<span class="keyword">const</span> std::shared_ptr&lt;const Model&gt;&amp; model, <span class="keyword">const</span> std::optional&lt;std::string&gt;&amp; file_path)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;{</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// check compatibility of the partial model</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// if this is the first partial model, accept the values</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a> == -1) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a> = model-&gt;num_labels();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae69f380355fba9530d157b0969226f21">m_NumFeatures</a> = model-&gt;num_features();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// we know what to expect, verify</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a> != model-&gt;num_labels()) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keywordflow">throw</span> std::logic_error(fmt::format(<span class="stringliteral">&quot;Received partial model for {} labels, but expected {} labels&quot;</span>,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                   model-&gt;num_labels(), <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a>));</div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a7df515ff71cf7cb781202cca12c61cde">  184</a></span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae69f380355fba9530d157b0969226f21">m_NumFeatures</a> != model-&gt;num_features()) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordflow">throw</span> std::logic_error(fmt::format(<span class="stringliteral">&quot;Received partial model for {} features, but expected {} features&quot;</span>,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                               model-&gt;num_features(), <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae69f380355fba9530d157b0969226f21">m_NumFeatures</a>));</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    path target_file = file_path.value_or(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span>(!file_path.has_value()) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        target_file.replace_filename(fmt::format(<span class="stringliteral">&quot;{}.weights-{}-{}&quot;</span>, <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>.filename().c_str(),</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                                 model-&gt;labels_begin().to_index(), model-&gt;labels_end().to_index() - 1));</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// find out where to insert this partial model into the ordered list</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a> new_weights_file{model-&gt;labels_begin(), model-&gt;num_weights(), target_file.filename(), <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a9638028ccd0f73fc6863d651a91d1c29">m_Options</a>.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#a398c2cc7bb2ab5b7776df266f77ca5e2">Format</a>};</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// skip if we don&#39;t want to save weights</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a9638028ccd0f73fc6863d651a91d1c29">m_Options</a>.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#a398c2cc7bb2ab5b7776df266f77ca5e2">Format</a> == <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794ab901a11d23ec68072265b7c78e650e50">WeightFormat::NULL_FORMAT</a>) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// if we don&#39;t actually want to write anything (e.g. for test cases, we just register the sub file and be done)</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a7df515ff71cf7cb781202cca12c61cde">insert_sub_file</a>(new_weights_file);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">return</span> std::async(std::launch::deferred, [new_weights_file](){</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">return</span> new_weights_file;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        });</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keyword">using namespace </span>std::chrono;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    std::fstream weights_file(target_file, std::fstream::out | std::fstream::binary);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span>(!weights_file.is_open()) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(fmt::format(<span class="stringliteral">&quot;Could not create weights file {}&quot;</span>, target_file.c_str()));</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// add the weights file to the list of weights</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a7df515ff71cf7cb781202cca12c61cde">insert_sub_file</a>(new_weights_file);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// OK, now we are sure everything is fine, do the actual work on saving stuff</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// we do this asynchronous, as we expect this to mostly IO bound</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">return</span> std::async(std::launch::async, [<span class="keyword">this</span>, target=std::move(weights_file), model, new_weights_file]() <span class="keyword">mutable</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">// let the saving thread only run on cores of the numa node which stores the model.</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// this assumes that the internal buffers of model are on the same node as model.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="namespacedismec_1_1parallel.html#a848b86d33c94c6e46c1497fd520aee57">parallel::pin_to_data</a>(model.get());</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keyword">auto</span> now = steady_clock::now();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a9225d86bc2ef9e003da72793de069491">save_weights_dispatch</a>(target, *model, <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a9638028ccd0f73fc6863d651a91d1c29">m_Options</a>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        spdlog::info(<span class="stringliteral">&quot;Saving partial model for weights {}-{} took {} ms&quot;</span>,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                     model-&gt;labels_begin().to_index(), model-&gt;labels_begin().to_index() + model-&gt;num_weights(),</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                     duration_cast&lt;milliseconds&gt;(steady_clock::now() - now).count());</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">return</span> new_weights_file;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    });</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#abc33455d761a5683ad624a0493b62a96">  234</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#abc33455d761a5683ad624a0493b62a96">PartialModelSaver::update_meta_file</a>() {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="model-io_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a> meta;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    meta[<span class="stringliteral">&quot;num-features&quot;</span>] = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae69f380355fba9530d157b0969226f21">m_NumFeatures</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    meta[<span class="stringliteral">&quot;num-labels&quot;</span>] = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    std::time_t tt = std::chrono::system_clock::to_time_t(std::chrono::system_clock::now());</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    std::tm tm = *std::gmtime(&amp;tt);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordtype">char</span> date_buffer[128];</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    strftime(date_buffer, <span class="keyword">sizeof</span>(date_buffer), <span class="stringliteral">&quot;%F - %T&quot;</span>, &amp;tm);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    meta[<span class="stringliteral">&quot;date&quot;</span>] = date_buffer;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; sub : <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>)</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <a class="code" href="model-io_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a> file_data = {{<span class="stringliteral">&quot;first&quot;</span>, sub.First.to_index()}, {<span class="stringliteral">&quot;count&quot;</span>, sub.Count},</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                          {<span class="stringliteral">&quot;file&quot;</span>, sub.FileName}, {<span class="stringliteral">&quot;weight-format&quot;</span>, <a class="code" href="namespacedismec_1_1io_1_1model.html#aaa4366a1f56e499dba21a786ca9ed6cf">to_string</a>(sub.Format)}};</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        meta[<span class="stringliteral">&quot;files&quot;</span>].push_back(file_data);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    std::fstream meta_file(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>, std::fstream::out);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    meta_file &lt;&lt; std::setw(4) &lt;&lt;  meta &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;}</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a5a62294a58a47848a0ad537a6da428e1">  255</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a5a62294a58a47848a0ad537a6da428e1">io::model::PartialModelSaver::any_weight_vector_for_interval</a>(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> begin, <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> end)<span class="keyword"> const</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keyword">auto</span> iter = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a0589c23b683b3d084a81cc5121a2994f">label_lower_bound</a>(begin);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// check that there is no overlap between partial models</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// if there is a successor element</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span>(iter != <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>.end()) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">if</span>(end &gt; iter-&gt;First) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// if there is a previous element, also check that</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">if</span>(iter != <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>.begin()) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; prev_el = *std::prev(iter);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span>(prev_el.First + prev_el.Count &gt; begin) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a0a11816ca461bb21679ef21d6d186b85">  277</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a0a11816ca461bb21679ef21d6d186b85">PartialModelSaver::finalize</a>() {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> last_end{0};</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; sub : <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">if</span>(last_end != sub.First) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="keywordflow">throw</span> std::logic_error(fmt::format(<span class="stringliteral">&quot;Some labels are missing. Gap from {} to {}&quot;</span>, last_end.to_index(), sub.First.to_index() - 1));</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        last_end = sub.First + sub.Count;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span>(last_end.to_index() != <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a>) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">throw</span> std::logic_error(fmt::format(<span class="stringliteral">&quot;Some labels are missing. Gap from {} to {}&quot;</span>, last_end.to_index(), <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a> - 1));</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#abc33455d761a5683ad624a0493b62a96">update_meta_file</a>();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a5c038996f9fa1f9bdb0921a0b79be347">  292</a></span>&#160;std::pair&lt;label_id_t, label_id_t&gt; <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a5c038996f9fa1f9bdb0921a0b79be347">PartialModelSaver::get_missing_weights</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> last_end{0};</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> label_end{<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a>};</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; sub : <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">if</span>(last_end != sub.First) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">return</span> {last_end, sub.First};</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        last_end = sub.First + sub.Count;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span>(last_end != label_end) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">return</span> {last_end, label_end};</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">return</span> {label_end, label_end};</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="namespacedismec_1_1io_1_1model.html#a8ca86376161fa59fa32d4f977e73ae7f">  308</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacedismec_1_1io_1_1model.html#a8ca86376161fa59fa32d4f977e73ae7f">io::model::save_model</a>(<span class="keyword">const</span> path&amp; target_file, <span class="keyword">const</span> std::shared_ptr&lt;const Model&gt;&amp; model, <a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html">SaveOption</a> options)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">if</span>(model-&gt;is_partial_model()) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;save_model can only save complete models&quot;</span>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html">PartialModelSaver</a> saver{target_file, options};</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// TODO more info, i.e. bias, which labels, etc</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span>(model-&gt;num_labels() &lt; options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#af24000aa9e30b519926ec2bf9a38854e">SplitFiles</a>) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        saver.add_model(model, fmt::format(<span class="stringliteral">&quot;{}.weights&quot;</span>, target_file.filename().c_str()));</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordtype">int</span> num_files = std::round( model-&gt;num_weights() / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#af24000aa9e30b519926ec2bf9a38854e">SplitFiles</a>) );</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> sub = 0; sub &lt; num_files; ++sub) {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            std::string weights_file_name = fmt::format(<span class="stringliteral">&quot;{}.weights-{}-of-{}&quot;</span>, target_file.filename().c_str(), 1+sub, num_files);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> first{sub * options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#af24000aa9e30b519926ec2bf9a38854e">SplitFiles</a>};</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordtype">long</span> end_label = (sub == num_files - 1) ? model-&gt;num_weights() : (sub+1) * options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#af24000aa9e30b519926ec2bf9a38854e">SplitFiles</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            end_label = std::min(end_label, model-&gt;num_labels());</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keyword">auto</span> submodel = std::make_shared&lt;::model::ConstSubModelView&gt;(model.get(), first, <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{end_label});</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            saver.add_model(submodel, weights_file_name);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    saver.finalize();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;}</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno"><a class="line" href="namespacedismec_1_1io_1_1model.html#a3aaaa30e84816663dbdb7a1d7694dba5">  334</a></span>&#160;std::shared_ptr&lt;Model&gt; <a class="code" href="namespacedismec_1_1io_1_1model.html#a3aaaa30e84816663dbdb7a1d7694dba5">io::model::load_model</a>(path source)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;{</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html">PartialModelLoader</a> loader{std::move(source)};</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">return</span> loader.<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a37773b456e5b9ab3a67b3ed561ed2730">load_model</a>(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{0}, <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{loader.num_labels()});</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#af2d22ad2b58256210543498fba609ba7">  341</a></span>&#160;<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#af2d22ad2b58256210543498fba609ba7">PartialModelLoader::PartialModelLoader</a>(path meta_file, <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732">ESparseMode</a> mode) :</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">m_MetaFileName</a>(std::move(meta_file)), m_SparseMode(mode) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a1a5062677d465c46092f06da27d618a6">read_metadata_file</a>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a01db07491f5c67894bad8ab801b6a32b">m_MetaFileName</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#ad2113703dffb7da003951abacc73d796">  346</a></span>&#160;<span class="keyword">auto</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#ad2113703dffb7da003951abacc73d796">PartialModelLoader::get_loading_range</a>(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> label_begin, <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> label_end) <span class="keyword">const</span> -&gt;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="structdismec_1_1io_1_1model_1_1PartialModelLoader_1_1SubModelRangeSpec.html">SubModelRangeSpec</a></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;{</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keyword">auto</span> sub_files = std::equal_range(begin(m_SubFiles), end(m_SubFiles),</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                      <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>{label_begin, label_end - label_begin, {}, <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794ab901a11d23ec68072265b7c78e650e50">WeightFormat::NULL_FORMAT</a>},</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                      [](<span class="keyword">const</span> <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>&amp; left, <span class="keyword">const</span> <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>&amp; right) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                          <span class="keyword">auto</span> a1 = left.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">First</a>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                          <span class="keyword">auto</span> a2 = right.First;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                          <span class="keyword">auto</span> b1 = a1 + left.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#aa85c89073400a857ee0ea1bb756e0a63">Count</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                          <span class="keywordflow">return</span> b1 &lt;= a2;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                      });</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span>(sub_files.first == end(m_SubFiles)) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(fmt::format(<span class="stringliteral">&quot;Could not find weights for interval [{}, {})&quot;</span>,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                             label_begin.to_index(), label_end.to_index()));</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keyword">auto</span> calc_label_count = [&amp;](){</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">if</span>(sub_files.second == end(m_SubFiles)) {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{m_TotalLabels};</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordflow">return</span> sub_files.second-&gt;First;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    };</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structdismec_1_1io_1_1model_1_1PartialModelLoader_1_1SubModelRangeSpec.html">SubModelRangeSpec</a>{sub_files.first, sub_files.second, sub_files.first-&gt;First, calc_label_count()};</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a37773b456e5b9ab3a67b3ed561ed2730">  373</a></span>&#160;std::shared_ptr&lt;Model&gt; <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a37773b456e5b9ab3a67b3ed561ed2730">PartialModelLoader::load_model</a>(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> label_begin, <a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a> label_end)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keyword">auto</span> sub_range = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#ad2113703dffb7da003951abacc73d796">get_loading_range</a>(label_begin, label_end);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="structdismec_1_1model_1_1PartialModelSpec.html">::model::PartialModelSpec</a> spec {sub_range.LabelsBegin, sub_range.LabelsEnd - sub_range.LabelsBegin, <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">m_TotalLabels</a>};</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">auto</span> model = std::make_shared&lt;::model::DenseModel&gt;(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae69f380355fba9530d157b0969226f21">m_NumFeatures</a>, spec);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> file = sub_range.FilesBegin; file &lt; sub_range.FilesEnd; ++file) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <a class="code" href="classdismec_1_1model_1_1SubModelWrapper.html">::model::SubModelView</a> submodel{model.get(), file-&gt;First, file-&gt;First + file-&gt;Count};</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        path weights_file = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a01db07491f5c67894bad8ab801b6a32b">m_MetaFileName</a>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        std::fstream source(weights_file.replace_filename(file-&gt;FileName), std::fstream::in);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">if</span>(!source.is_open()) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <a class="code" href="common_8h.html#a9088ca6fe6da4afd367a66de589386b8">THROW_ERROR</a>(<span class="stringliteral">&quot;Could not open weights file &quot;</span>, weights_file.replace_filename(file-&gt;FileName).string());</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a98c539a9fad358a4456c8a92bbb2cd12">read_weights_dispatch</a>(source, file-&gt;Format, submodel);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        spdlog::info(<span class="stringliteral">&quot;read weight file {}&quot;</span>, weights_file.replace_filename(file-&gt;FileName).c_str());</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span> model;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a4b9048dff882218f04055da6aeb1728f">  395</a></span>&#160;<span class="keywordtype">long</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a4b9048dff882218f04055da6aeb1728f">PartialModelLoader::num_weight_files</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>.size();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#ad0c23ad1d6b907d7f6678361cb25acf8">  400</a></span>&#160;    std::shared_ptr&lt;Model&gt; <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#ad0c23ad1d6b907d7f6678361cb25acf8">make_model</a>(<span class="keywordtype">long</span> num_features, ::<a class="code" href="structdismec_1_1model_1_1PartialModelSpec.html">model::PartialModelSpec</a> spec, <span class="keywordtype">bool</span> sparse) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">if</span>(sparse) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">return</span> std::make_shared&lt;::model::SparseModel&gt;(num_features, spec);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="keywordflow">return</span> std::make_shared&lt;::model::DenseModel&gt;(num_features, spec);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#adcf90935cf2c8e080f751eac26e86d7b">  408</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#adcf90935cf2c8e080f751eac26e86d7b">use_sparse_weights</a>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732">PartialModelLoader::ESparseMode</a> mode, <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794">WeightFormat</a> format) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">switch</span> (mode) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732a60fc63b98948aaa70fc3625156d85f07">PartialModelLoader::FORCE_SPARSE</a>:</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732a3c3a4e6fa9b5c0969df0293f9def4644">PartialModelLoader::FORCE_DENSE</a>:</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732a81b00b3782c66247b104b2aa3d438315">PartialModelLoader::DEFAULT</a>:</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#abb30b1d03973f7fde16bdf04b0708ca8">weight_format_sparsity</a>[<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(format)];</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                assert(0);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                __builtin_unreachable();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a70492767777613983bcce1c4b9ee8149">  423</a></span>&#160;std::shared_ptr&lt;Model&gt; <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a37773b456e5b9ab3a67b3ed561ed2730">PartialModelLoader::load_model</a>(<span class="keywordtype">int</span> index)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keyword">auto</span> start = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keyword">const</span> <a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>&amp; entry = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>.at(index);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <a class="code" href="structdismec_1_1model_1_1PartialModelSpec.html">::model::PartialModelSpec</a> spec {entry.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">First</a>, entry.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#aa85c89073400a857ee0ea1bb756e0a63">Count</a>, <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#adf1ff8789d836388c4dfc541f1b44f3b">num_labels</a>()};</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keyword">auto</span> model = <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#ad0c23ad1d6b907d7f6678361cb25acf8">make_model</a>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae237aa199cf2114eff1a68aa3268257f">num_features</a>(), spec, <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#adcf90935cf2c8e080f751eac26e86d7b">use_sparse_weights</a>(<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a0a1ddc2f897de28419ed2567a80ec228">m_SparseMode</a>, entry.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a335db97c81d7234ede34f510b25efc38">Format</a>));</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    path weights_file = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#aa91d08c290d082967033c58275026d7e">meta_file_path</a>();</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    std::fstream source(weights_file.replace_filename(entry.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a8b652340340a136a8d8fef015f0043bc">FileName</a>), std::fstream::in);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span>(!source.is_open()) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <a class="code" href="common_8h.html#a9088ca6fe6da4afd367a66de589386b8">THROW_ERROR</a>(<span class="stringliteral">&quot;Could not open weights file &#39;{}&#39;&quot;</span>, weights_file.replace_filename(entry.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a8b652340340a136a8d8fef015f0043bc">FileName</a>).string());</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a98c539a9fad358a4456c8a92bbb2cd12">read_weights_dispatch</a>(source, entry.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a335db97c81d7234ede34f510b25efc38">Format</a>, *model);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keyword">auto</span> duration = std::chrono::steady_clock::now() - start;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    spdlog::info(<span class="stringliteral">&quot;read weight file &#39;{}&#39; in {}ms&quot;</span>, weights_file.replace_filename(entry.<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a8b652340340a136a8d8fef015f0043bc">FileName</a>).c_str(),</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                 std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(duration).count());</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">return</span> model;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno"><a class="line" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a8226681710c3b36bc851ee5af49b08e9">  441</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a8226681710c3b36bc851ee5af49b08e9">PartialModelLoader::validate</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry: <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">m_SubFiles</a>) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        path weights_file = <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#aa91d08c290d082967033c58275026d7e">meta_file_path</a>();</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keyword">auto</span> wf = weights_file.replace_filename(entry.FileName);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="comment">// check existence</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span>(!std::filesystem::exists(wf)) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            spdlog::error(<span class="stringliteral">&quot;Weight file &#39;{}&#39; does not exist!&quot;</span>, wf.string());</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            valid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="comment">// check if we can actually open it</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        std::fstream source(weights_file.replace_filename(entry.FileName), std::fstream::in);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span>(!source.is_open()) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            spdlog::error(<span class="stringliteral">&quot;Could not open weight file &#39;{}&#39;&quot;</span>, wf.string());</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            valid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">return</span> valid;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="preprocessor">#include &quot;doctest.h&quot;</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;using ::model::DenseModel;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;using ::model::PartialModelSpec;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="model-io_8cpp.html#ad4ace95ffb6afe677c9328cdd7c0803c">  478</a></span>&#160;<a class="code" href="model-io_8cpp.html#ad4ace95ffb6afe677c9328cdd7c0803c">TEST_CASE</a>(<span class="stringliteral">&quot;partial model writer verifier&quot;</span>) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html">SaveOption</a> options;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    options.<a class="code" href="structdismec_1_1io_1_1model_1_1SaveOption.html#a398c2cc7bb2ab5b7776df266f77ca5e2">Format</a> = <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794ab901a11d23ec68072265b7c78e650e50">WeightFormat::NULL_FORMAT</a>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    std::filesystem::create_directory(<span class="stringliteral">&quot;test&quot;</span>);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html">PartialModelSaver</a> pms(<span class="stringliteral">&quot;test/pms-test&quot;</span>, options);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keyword">auto</span> first_part = std::make_shared&lt;DenseModel&gt;(4, PartialModelSpec{<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{1}, 4, 20});</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// this just causes the setup, we can&#39;t create any contradictions yet</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    REQUIRE_NOTHROW(pms.<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">add_model</a>(first_part));</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    SUBCASE(<span class="stringliteral">&quot;mismatched features&quot;</span>) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        PartialModelSpec spec{<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{5}, 2, 20};</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keyword">auto</span> mismatched_features = std::make_shared&lt;DenseModel&gt;(7, spec);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keyword">auto</span> valid = std::make_shared&lt;DenseModel&gt;(4, spec);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        REQUIRE_THROWS(pms.<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">add_model</a>(mismatched_features));</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        CHECK_NOTHROW(pms.<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">add_model</a>(valid));</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    SUBCASE(<span class="stringliteral">&quot;mismatched total labels&quot;</span>) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keyword">auto</span> mismatched_labels = std::make_shared&lt;DenseModel&gt;(4, PartialModelSpec{<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{5}, 2, 50});</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keyword">auto</span> valid = std::make_shared&lt;DenseModel&gt;(4, PartialModelSpec{<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{5}, 2, 20});</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        REQUIRE_THROWS(pms.<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">add_model</a>(mismatched_labels));</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        CHECK_NOTHROW(pms.<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">add_model</a>(valid));</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    SUBCASE(<span class="stringliteral">&quot;incomplete model&quot;</span>) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        CHECK_THROWS(pms.<a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a0a11816ca461bb21679ef21d6d186b85">finalize</a>());</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;}</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno"><a class="line" href="model-io_8cpp.html#af3ccff6ab7e93045877d8516ff69e5e5">  508</a></span>&#160;<a class="code" href="model-io_8cpp.html#ad4ace95ffb6afe677c9328cdd7c0803c">TEST_CASE</a>(<span class="stringliteral">&quot;label lower bound&quot;</span>) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">struct </span>TestModel : <span class="keyword">public</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html">PartialModelIO</a> {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keyword">using</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a0589c23b683b3d084a81cc5121a2994f">PartialModelIO::label_lower_bound</a>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keyword">using</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">PartialModelIO::m_SubFiles</a>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        TestModel() {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            m_SubFiles.push_back(<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>{<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{20}, 30, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a6d5ba618729df78c44be2ffc850fa281">WeightFormat::DENSE_TXT</a>});</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            m_SubFiles.push_back(<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>{<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{100}, 50, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a6d5ba618729df78c44be2ffc850fa281">WeightFormat::DENSE_TXT</a>});</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    };</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    TestModel tm{};</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{0}) == tm.m_SubFiles.begin());</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{20}) == tm.m_SubFiles.begin());</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{40}) == tm.m_SubFiles.begin() + 1);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{50}) == tm.m_SubFiles.begin() + 1);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{80}) == tm.m_SubFiles.begin() + 1);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{100}) == tm.m_SubFiles.begin() + 1);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{120}) == tm.m_SubFiles.end());</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    CHECK(tm.label_lower_bound(<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{200}) == tm.m_SubFiles.end());</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;}</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="model-io_8cpp.html#aed9f824608fd0c2ea295036ddf56be1d">  529</a></span>&#160;<a class="code" href="model-io_8cpp.html#ad4ace95ffb6afe677c9328cdd7c0803c">TEST_CASE</a>(<span class="stringliteral">&quot;insert_sub_file&quot;</span>) {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keyword">struct </span>TestModel : <span class="keyword">public</span> <a class="code" href="classdismec_1_1io_1_1model_1_1PartialModelIO.html">PartialModelIO</a> {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        TestModel() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        ~TestModel() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordtype">void</span> insert(<span class="keywordtype">long</span> first, <span class="keywordtype">long</span> count) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            insert_sub_file(<a class="code" href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">WeightFileEntry</a>{<a class="code" href="classdismec_1_1label__id__t.html">label_id_t</a>{first}, count, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794ab901a11d23ec68072265b7c78e650e50">WeightFormat::NULL_FORMAT</a>});</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    };</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    TestModel pms;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// this just causes the setup, we can&#39;t create any contradictions yet</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    REQUIRE_NOTHROW(pms.insert(1, 4));</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    SUBCASE(<span class="stringliteral">&quot;overlap predecessor&quot;</span>) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        REQUIRE_THROWS(pms.insert(4, 2));</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        CHECK_NOTHROW(pms.insert(5, 2));</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    SUBCASE(<span class="stringliteral">&quot;overlap successor&quot;</span>) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        REQUIRE_THROWS(pms.insert(0, 2));</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        CHECK_NOTHROW(pms.insert(0, 1));</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html">dismec::io::model::PartialModelIO</a></div><div class="ttdoc">This class is used as an implementation detail to capture the common code of PartialModelSaver and Pa...</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00151">model-io.h:151</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_a0589c23b683b3d084a81cc5121a2994f"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a0589c23b683b3d084a81cc5121a2994f">dismec::io::model::PartialModelIO::label_lower_bound</a></div><div class="ttdeci">weight_file_iter_t label_lower_bound(label_id_t pos) const</div><div class="ttdoc">Gets an iterator into the weight-file list that points to the first element whose starting label is l...</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00116">model-io.cpp:116</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_a09590d987bef63164b61de2a8a407234"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a09590d987bef63164b61de2a8a407234">dismec::io::model::PartialModelIO::m_TotalLabels</a></div><div class="ttdeci">long m_TotalLabels</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00173">model-io.h:173</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_a1a5062677d465c46092f06da27d618a6"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a1a5062677d465c46092f06da27d618a6">dismec::io::model::PartialModelIO::read_metadata_file</a></div><div class="ttdeci">void read_metadata_file(const path &amp;meta_file)</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00093">model-io.cpp:93</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_a7df515ff71cf7cb781202cca12c61cde"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#a7df515ff71cf7cb781202cca12c61cde">dismec::io::model::PartialModelIO::insert_sub_file</a></div><div class="ttdeci">void insert_sub_file(const WeightFileEntry &amp;data)</div><div class="ttdoc">Inserts a new sub-file entry into the metadata object.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00123">model-io.cpp:123</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_abdaa8c6e0747a3e5d522d32d8a039700"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#abdaa8c6e0747a3e5d522d32d8a039700">dismec::io::model::PartialModelIO::m_SubFiles</a></div><div class="ttdeci">std::vector&lt; WeightFileEntry &gt; m_SubFiles</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00176">model-io.h:176</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_adf1ff8789d836388c4dfc541f1b44f3b"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#adf1ff8789d836388c4dfc541f1b44f3b">dismec::io::model::PartialModelIO::num_labels</a></div><div class="ttdeci">long num_labels() const noexcept</div><div class="ttdoc">Gets the total number of labels.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00158">model-io.h:158</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_ae237aa199cf2114eff1a68aa3268257f"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae237aa199cf2114eff1a68aa3268257f">dismec::io::model::PartialModelIO::num_features</a></div><div class="ttdeci">long num_features() const noexcept</div><div class="ttdoc">Gets the total number of features.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00165">model-io.h:165</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelIO_html_ae69f380355fba9530d157b0969226f21"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelIO.html#ae69f380355fba9530d157b0969226f21">dismec::io::model::PartialModelIO::m_NumFeatures</a></div><div class="ttdeci">long m_NumFeatures</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00174">model-io.h:174</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html">dismec::io::model::PartialModelLoader</a></div><div class="ttdoc">This class allows loading only a subset of the weights of a large model.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00317">model-io.h:317</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a01db07491f5c67894bad8ab801b6a32b"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a01db07491f5c67894bad8ab801b6a32b">dismec::io::model::PartialModelLoader::m_MetaFileName</a></div><div class="ttdeci">path m_MetaFileName</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00374">model-io.h:374</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a0a1ddc2f897de28419ed2567a80ec228"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a0a1ddc2f897de28419ed2567a80ec228">dismec::io::model::PartialModelLoader::m_SparseMode</a></div><div class="ttdeci">ESparseMode m_SparseMode</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00375">model-io.h:375</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a37773b456e5b9ab3a67b3ed561ed2730"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a37773b456e5b9ab3a67b3ed561ed2730">dismec::io::model::PartialModelLoader::load_model</a></div><div class="ttdeci">std::shared_ptr&lt; Model &gt; load_model(label_id_t label_begin, label_id_t label_end) const</div><div class="ttdoc">Loads part of the model.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00373">model-io.cpp:373</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a4b9048dff882218f04055da6aeb1728f"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a4b9048dff882218f04055da6aeb1728f">dismec::io::model::PartialModelLoader::num_weight_files</a></div><div class="ttdeci">long num_weight_files() const</div><div class="ttdoc">Returns the number of availabel weight files.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00395">model-io.cpp:395</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a6c6b9079af1c1305c17f2f44ab5b3732"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732">dismec::io::model::PartialModelLoader::ESparseMode</a></div><div class="ttdeci">ESparseMode</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00319">model-io.h:319</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a6c6b9079af1c1305c17f2f44ab5b3732a3c3a4e6fa9b5c0969df0293f9def4644"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732a3c3a4e6fa9b5c0969df0293f9def4644">dismec::io::model::PartialModelLoader::FORCE_DENSE</a></div><div class="ttdeci">@ FORCE_DENSE</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00323">model-io.h:322</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a6c6b9079af1c1305c17f2f44ab5b3732a60fc63b98948aaa70fc3625156d85f07"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732a60fc63b98948aaa70fc3625156d85f07">dismec::io::model::PartialModelLoader::FORCE_SPARSE</a></div><div class="ttdeci">@ FORCE_SPARSE</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00321">model-io.h:321</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a6c6b9079af1c1305c17f2f44ab5b3732a81b00b3782c66247b104b2aa3d438315"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a6c6b9079af1c1305c17f2f44ab5b3732a81b00b3782c66247b104b2aa3d438315">dismec::io::model::PartialModelLoader::DEFAULT</a></div><div class="ttdeci">@ DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00320">model-io.h:320</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_a8226681710c3b36bc851ee5af49b08e9"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#a8226681710c3b36bc851ee5af49b08e9">dismec::io::model::PartialModelLoader::validate</a></div><div class="ttdeci">bool validate() const</div><div class="ttdoc">Validates that all weight files exist.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00441">model-io.cpp:441</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_aa91d08c290d082967033c58275026d7e"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#aa91d08c290d082967033c58275026d7e">dismec::io::model::PartialModelLoader::meta_file_path</a></div><div class="ttdeci">const path &amp; meta_file_path() const</div><div class="ttdoc">The path to the metadata file.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00338">model-io.h:338</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_ad2113703dffb7da003951abacc73d796"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#ad2113703dffb7da003951abacc73d796">dismec::io::model::PartialModelLoader::get_loading_range</a></div><div class="ttdeci">SubModelRangeSpec get_loading_range(label_id_t label_begin, label_id_t label_end) const</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00346">model-io.cpp:346</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelLoader_html_af2d22ad2b58256210543498fba609ba7"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelLoader.html#af2d22ad2b58256210543498fba609ba7">dismec::io::model::PartialModelLoader::PartialModelLoader</a></div><div class="ttdeci">PartialModelLoader(path meta_file, ESparseMode mode=DEFAULT)</div><div class="ttdoc">Create a new PartialModelLoader for the given metadata file.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00341">model-io.cpp:341</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html">dismec::io::model::PartialModelSaver</a></div><div class="ttdoc">Manage saving a model consisting of multiple partial models.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00236">model-io.h:236</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_a0a11816ca461bb21679ef21d6d186b85"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a0a11816ca461bb21679ef21d6d186b85">dismec::io::model::PartialModelSaver::finalize</a></div><div class="ttdeci">void finalize()</div><div class="ttdoc">Checks that all weights have been written and updates the metadata file.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00277">model-io.cpp:277</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_a2756f72407e4d8731fbe758729cc0ddd"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a2756f72407e4d8731fbe758729cc0ddd">dismec::io::model::PartialModelSaver::PartialModelSaver</a></div><div class="ttdeci">PartialModelSaver(path target_file, SaveOption options, bool load_partial=false)</div><div class="ttdoc">Create a new PartialModelSaver.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00160">model-io.cpp:160</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_a5a62294a58a47848a0ad537a6da428e1"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a5a62294a58a47848a0ad537a6da428e1">dismec::io::model::PartialModelSaver::any_weight_vector_for_interval</a></div><div class="ttdeci">bool any_weight_vector_for_interval(label_id_t begin, label_id_t end) const</div><div class="ttdoc">Checks if there are any weight vectors for the given interval.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00255">model-io.cpp:255</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_a5c038996f9fa1f9bdb0921a0b79be347"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a5c038996f9fa1f9bdb0921a0b79be347">dismec::io::model::PartialModelSaver::get_missing_weights</a></div><div class="ttdeci">std::pair&lt; label_id_t, label_id_t &gt; get_missing_weights() const</div><div class="ttdoc">Get an interval labels for which weights are missing.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00292">model-io.cpp:292</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_a704d4ae447cb0d7cef57a739bc107711"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a704d4ae447cb0d7cef57a739bc107711">dismec::io::model::PartialModelSaver::add_model</a></div><div class="ttdeci">std::future&lt; WeightFileEntry &gt; add_model(const std::shared_ptr&lt; const Model &gt; &amp;model, const std::optional&lt; std::string &gt; &amp;file_path={})</div><div class="ttdoc">Adds the weights of a partial model asynchronously.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00172">model-io.cpp:172</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_a7df515ff71cf7cb781202cca12c61cde"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a7df515ff71cf7cb781202cca12c61cde">dismec::io::model::PartialModelSaver::insert_sub_file</a></div><div class="ttdeci">void insert_sub_file(const WeightFileEntry &amp;data)</div><div class="ttdoc">Inserts a new sub-file entry into the metadata object.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00184">model-io.cpp:123</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_a9638028ccd0f73fc6863d651a91d1c29"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#a9638028ccd0f73fc6863d651a91d1c29">dismec::io::model::PartialModelSaver::m_Options</a></div><div class="ttdeci">SaveOption m_Options</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00308">model-io.h:308</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_ab1386580f728eb4ce8642e5bc53aa7e9"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#ab1386580f728eb4ce8642e5bc53aa7e9">dismec::io::model::PartialModelSaver::m_MetaFileName</a></div><div class="ttdeci">path m_MetaFileName</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00309">model-io.h:309</a></div></div>
<div class="ttc" id="aclassdismec_1_1io_1_1model_1_1PartialModelSaver_html_abc33455d761a5683ad624a0493b62a96"><div class="ttname"><a href="classdismec_1_1io_1_1model_1_1PartialModelSaver.html#abc33455d761a5683ad624a0493b62a96">dismec::io::model::PartialModelSaver::update_meta_file</a></div><div class="ttdeci">void update_meta_file()</div><div class="ttdoc">Updates the metadata file.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00234">model-io.cpp:234</a></div></div>
<div class="ttc" id="aclassdismec_1_1label__id__t_html"><div class="ttname"><a href="classdismec_1_1label__id__t.html">dismec::label_id_t</a></div><div class="ttdoc">Strong typedef for an int to signify a label id.</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00020">types.h:20</a></div></div>
<div class="ttc" id="aclassdismec_1_1model_1_1Model_html"><div class="ttname"><a href="classdismec_1_1model_1_1Model.html">dismec::model::Model</a></div><div class="ttdoc">A model combines a set of weight with some meta-information about these weights.</div><div class="ttdef"><b>Definition:</b> <a href="model_8h_source.html#l00063">model.h:63</a></div></div>
<div class="ttc" id="aclassdismec_1_1model_1_1SubModelWrapper_html"><div class="ttname"><a href="classdismec_1_1model_1_1SubModelWrapper.html">dismec::model::SubModelWrapper</a></div><div class="ttdef"><b>Definition:</b> <a href="submodel_8h_source.html#l00013">submodel.h:13</a></div></div>
<div class="ttc" id="aclassdismec_1_1opaque__int__type_html_a232ac208e73d81fd570c9e3f94c8207b"><div class="ttname"><a href="classdismec_1_1opaque__int__type.html#a232ac208e73d81fd570c9e3f94c8207b">dismec::opaque_int_type::to_index</a></div><div class="ttdeci">constexpr T to_index() const</div><div class="ttdoc">! Explicitly convert to an integer.</div><div class="ttdef"><b>Definition:</b> <a href="opaque__int_8h_source.html#l00032">opaque_int.h:32</a></div></div>
<div class="ttc" id="acommon_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div><div class="ttdoc">building blocks for io procedures that are used by multiple io subsystems</div></div>
<div class="ttc" id="acommon_8h_html_a9088ca6fe6da4afd367a66de589386b8"><div class="ttname"><a href="common_8h.html#a9088ca6fe6da4afd367a66de589386b8">THROW_ERROR</a></div><div class="ttdeci">#define THROW_ERROR(...)</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00023">common.h:23</a></div></div>
<div class="ttc" id="adense_8h_html"><div class="ttname"><a href="dense_8h.html">dense.h</a></div></div>
<div class="ttc" id="amodel-io_8cpp_html_ab701e3ac61a85b337ec5c1abaad6742d"><div class="ttname"><a href="model-io_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></div><div class="ttdeci">nlohmann::json json</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00022">model-io.cpp:22</a></div></div>
<div class="ttc" id="amodel-io_8cpp_html_ad4ace95ffb6afe677c9328cdd7c0803c"><div class="ttname"><a href="model-io_8cpp.html#ad4ace95ffb6afe677c9328cdd7c0803c">TEST_CASE</a></div><div class="ttdeci">TEST_CASE(&quot;partial model writer verifier&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00478">model-io.cpp:478</a></div></div>
<div class="ttc" id="amodel-io_8h_html"><div class="ttname"><a href="model-io_8h.html">model-io.h</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02model-io_8cpp_03_html_a9225d86bc2ef9e003da72793de069491"><div class="ttname"><a href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a9225d86bc2ef9e003da72793de069491">anonymous_namespace{model-io.cpp}::save_weights_dispatch</a></div><div class="ttdeci">void save_weights_dispatch(std::ostream &amp;target, const Model &amp;model, SaveOption &amp;options)</div><div class="ttdoc">This function calls on of the save functions, depending on the format specified on options</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00043">model-io.cpp:43</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02model-io_8cpp_03_html_a98c539a9fad358a4456c8a92bbb2cd12"><div class="ttname"><a href="namespaceanonymous__namespace_02model-io_8cpp_03.html#a98c539a9fad358a4456c8a92bbb2cd12">anonymous_namespace{model-io.cpp}::read_weights_dispatch</a></div><div class="ttdeci">void read_weights_dispatch(std::istream &amp;source, WeightFormat format, Model &amp;model)</div><div class="ttdoc">This function calls the reads function that corresponds to the given weight format.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00067">model-io.cpp:67</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02model-io_8cpp_03_html_aaf31c2405cf93b23a7005de8a4860266"><div class="ttname"><a href="namespaceanonymous__namespace_02model-io_8cpp_03.html#aaf31c2405cf93b23a7005de8a4860266">anonymous_namespace{model-io.cpp}::weight_format_names</a></div><div class="ttdeci">const std::array&lt; const char *, 4 &gt; weight_format_names</div><div class="ttdoc">Translation from io::model::WeightFormat to std::string.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00028">model-io.cpp:28</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02model-io_8cpp_03_html_abb30b1d03973f7fde16bdf04b0708ca8"><div class="ttname"><a href="namespaceanonymous__namespace_02model-io_8cpp_03.html#abb30b1d03973f7fde16bdf04b0708ca8">anonymous_namespace{model-io.cpp}::weight_format_sparsity</a></div><div class="ttdeci">const std::array&lt; bool, 4 &gt; weight_format_sparsity</div><div class="ttdoc">Lookup which mode has sparse weights.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00033">model-io.cpp:33</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02model-io_8cpp_03_html_ad0c23ad1d6b907d7f6678361cb25acf8"><div class="ttname"><a href="namespaceanonymous__namespace_02model-io_8cpp_03.html#ad0c23ad1d6b907d7f6678361cb25acf8">anonymous_namespace{model-io.cpp}::make_model</a></div><div class="ttdeci">std::shared_ptr&lt; Model &gt; make_model(long num_features, ::model::PartialModelSpec spec, bool sparse)</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00400">model-io.cpp:400</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02model-io_8cpp_03_html_adcf90935cf2c8e080f751eac26e86d7b"><div class="ttname"><a href="namespaceanonymous__namespace_02model-io_8cpp_03.html#adcf90935cf2c8e080f751eac26e86d7b">anonymous_namespace{model-io.cpp}::use_sparse_weights</a></div><div class="ttdeci">bool use_sparse_weights(PartialModelLoader::ESparseMode mode, WeightFormat format)</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00408">model-io.cpp:408</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html">dismec::io::model</a></div><div class="ttdoc">namespace for all model-related io functions.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00091">model-io.h:92</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_a09c54fa7d58827f37b2e737624a99e40"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#a09c54fa7d58827f37b2e737624a99e40">dismec::io::model::load_sparse_weights_txt</a></div><div class="ttdeci">void load_sparse_weights_txt(std::istream &amp;source, Model &amp;target)</div><div class="ttdoc">Loads sparse weights from plain-text format.</div><div class="ttdef"><b>Definition:</b> <a href="weights_8cpp_source.html#l00140">weights.cpp:140</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_a3aaaa30e84816663dbdb7a1d7694dba5"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#a3aaaa30e84816663dbdb7a1d7694dba5">dismec::io::model::load_model</a></div><div class="ttdeci">std::shared_ptr&lt; Model &gt; load_model(path source)</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00334">model-io.cpp:334</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_a40d9a974c3183de5a571bd95f73fb73d"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#a40d9a974c3183de5a571bd95f73fb73d">dismec::io::model::parse_weights_format</a></div><div class="ttdeci">WeightFormat parse_weights_format(std::string_view name)</div><div class="ttdoc">Gets the eighs.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00084">model-io.cpp:84</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_a4d86304e254fb573e16ec8c846ee3a41"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#a4d86304e254fb573e16ec8c846ee3a41">dismec::io::model::save_dense_weights_npy</a></div><div class="ttdeci">void save_dense_weights_npy(std::streambuf &amp;target, const Model &amp;model)</div><div class="ttdoc">Saves the dense weights in a npy file.</div><div class="ttdef"><b>Definition:</b> <a href="weights_8cpp_source.html#l00073">weights.cpp:73</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_a8ca86376161fa59fa32d4f977e73ae7f"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#a8ca86376161fa59fa32d4f977e73ae7f">dismec::io::model::save_model</a></div><div class="ttdeci">void save_model(const path &amp;target_file, const std::shared_ptr&lt; const Model &gt; &amp;model, SaveOption options)</div><div class="ttdoc">Saves a complete model to a file.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00308">model-io.cpp:308</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_a9d15f7ead589f5d5153b1fe92e257aef"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#a9d15f7ead589f5d5153b1fe92e257aef">dismec::io::model::save_as_sparse_weights_txt</a></div><div class="ttdeci">void save_as_sparse_weights_txt(std::ostream &amp;target, const Model &amp;model, double threshold)</div><div class="ttdoc">Saves the weights in sparse plain-text format, culling small weights.</div><div class="ttdef"><b>Definition:</b> <a href="weights_8cpp_source.html#l00111">weights.cpp:111</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_aa296f53aedee6f59002fa01439ebc794"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794">dismec::io::model::WeightFormat</a></div><div class="ttdeci">WeightFormat</div><div class="ttdoc">Describes the format in which the weight data has been saved.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00099">model-io.h:99</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_aa296f53aedee6f59002fa01439ebc794a6d5ba618729df78c44be2ffc850fa281"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a6d5ba618729df78c44be2ffc850fa281">dismec::io::model::WeightFormat::DENSE_TXT</a></div><div class="ttdeci">@ DENSE_TXT</div><div class="ttdoc">Dense Text Format</div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_aa296f53aedee6f59002fa01439ebc794a9e31d6cbca343a71693a681e7eb427ec"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794a9e31d6cbca343a71693a681e7eb427ec">dismec::io::model::WeightFormat::SPARSE_TXT</a></div><div class="ttdeci">@ SPARSE_TXT</div><div class="ttdoc">Sparse Text Format</div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_aa296f53aedee6f59002fa01439ebc794ab901a11d23ec68072265b7c78e650e50"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794ab901a11d23ec68072265b7c78e650e50">dismec::io::model::WeightFormat::NULL_FORMAT</a></div><div class="ttdeci">@ NULL_FORMAT</div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_aa296f53aedee6f59002fa01439ebc794af0c60767b8402acf1f1bd256c0fa1e9e"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#aa296f53aedee6f59002fa01439ebc794af0c60767b8402acf1f1bd256c0fa1e9e">dismec::io::model::WeightFormat::DENSE_NPY</a></div><div class="ttdeci">@ DENSE_NPY</div><div class="ttdoc">Dense Numpy Format</div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_aaa4366a1f56e499dba21a786ca9ed6cf"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#aaa4366a1f56e499dba21a786ca9ed6cf">dismec::io::model::to_string</a></div><div class="ttdeci">const char * to_string(WeightFormat format)</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8cpp_source.html#l00089">model-io.cpp:89</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_ab23fe02efae025836a76b0ee57ed4b60"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#ab23fe02efae025836a76b0ee57ed4b60">dismec::io::model::load_dense_weights_txt</a></div><div class="ttdeci">void load_dense_weights_txt(std::istream &amp;source, Model &amp;target)</div><div class="ttdoc">Loads weights saved by io::model::save_dense_weights_txt.</div><div class="ttdef"><b>Definition:</b> <a href="weights_8cpp_source.html#l00061">weights.cpp:61</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_abfdbf4d49bb96037d6b6df2ce7909191"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#abfdbf4d49bb96037d6b6df2ce7909191">dismec::io::model::save_dense_weights_txt</a></div><div class="ttdeci">void save_dense_weights_txt(std::ostream &amp;target, const Model &amp;model)</div><div class="ttdoc">Saves the dense weights in a plain-text format.</div><div class="ttdef"><b>Definition:</b> <a href="weights_8cpp_source.html#l00051">weights.cpp:51</a></div></div>
<div class="ttc" id="anamespacedismec_1_1io_1_1model_html_acb349249b869b7b98cc15bd1c443e6a3"><div class="ttname"><a href="namespacedismec_1_1io_1_1model.html#acb349249b869b7b98cc15bd1c443e6a3">dismec::io::model::load_dense_weights_npy</a></div><div class="ttdeci">void load_dense_weights_npy(std::streambuf &amp;target, Model &amp;model)</div><div class="ttdoc">Loads dense weights from a npy file.</div><div class="ttdef"><b>Definition:</b> <a href="weights_8cpp_source.html#l00082">weights.cpp:82</a></div></div>
<div class="ttc" id="anamespacedismec_1_1parallel_html_a848b86d33c94c6e46c1497fd520aee57"><div class="ttname"><a href="namespacedismec_1_1parallel.html#a848b86d33c94c6e46c1497fd520aee57">dismec::parallel::pin_to_data</a></div><div class="ttdeci">void pin_to_data(const void *data)</div><div class="ttdoc">Pint the calling thread to the NUMA node on which data resides.</div><div class="ttdef"><b>Definition:</b> <a href="numa_8cpp_source.html#l00078">numa.cpp:78</a></div></div>
<div class="ttc" id="anamespacedismec_html"><div class="ttname"><a href="namespacedismec.html">dismec</a></div><div class="ttdoc">Main namespace in which all types, classes, and functions are defined.</div><div class="ttdef"><b>Definition:</b> <a href="app_8h_source.html#l00015">app.h:15</a></div></div>
<div class="ttc" id="anuma_8h_html"><div class="ttname"><a href="numa_8h.html">numa.h</a></div></div>
<div class="ttc" id="asparse_8h_html"><div class="ttname"><a href="sparse_8h.html">sparse.h</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1PartialModelLoader_1_1SubModelRangeSpec_html"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1PartialModelLoader_1_1SubModelRangeSpec.html">dismec::io::model::PartialModelLoader::SubModelRangeSpec</a></div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00365">model-io.h:365</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1SaveOption_html"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1SaveOption.html">dismec::io::model::SaveOption</a></div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00111">model-io.h:111</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1SaveOption_html_a398c2cc7bb2ab5b7776df266f77ca5e2"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1SaveOption.html#a398c2cc7bb2ab5b7776df266f77ca5e2">dismec::io::model::SaveOption::Format</a></div><div class="ttdeci">WeightFormat Format</div><div class="ttdoc">Format in which the weights will be saved.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00115">model-io.h:115</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1SaveOption_html_aa79275e4cea9cb62b3ad06c3ab89859f"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1SaveOption.html#aa79275e4cea9cb62b3ad06c3ab89859f">dismec::io::model::SaveOption::Culling</a></div><div class="ttdeci">double Culling</div><div class="ttdoc">If saving in sparse mode, threshold below which weights will be omitted.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00113">model-io.h:113</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1SaveOption_html_ab106728c3c55992c486e8242b8f838fa"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1SaveOption.html#ab106728c3c55992c486e8242b8f838fa">dismec::io::model::SaveOption::Precision</a></div><div class="ttdeci">int Precision</div><div class="ttdoc">Precision with which the labels will be saved.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00112">model-io.h:112</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1SaveOption_html_af24000aa9e30b519926ec2bf9a38854e"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1SaveOption.html#af24000aa9e30b519926ec2bf9a38854e">dismec::io::model::SaveOption::SplitFiles</a></div><div class="ttdeci">int SplitFiles</div><div class="ttdoc">Maximum number of weight vectors per file.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00114">model-io.h:114</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1WeightFileEntry_html"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html">dismec::io::model::WeightFileEntry</a></div><div class="ttdoc">Collect the data about a weight file.</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00139">model-io.h:139</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1WeightFileEntry_html_a335db97c81d7234ede34f510b25efc38"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a335db97c81d7234ede34f510b25efc38">dismec::io::model::WeightFileEntry::Format</a></div><div class="ttdeci">WeightFormat Format</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00143">model-io.h:143</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1WeightFileEntry_html_a47743a88a6612d3d625e0725f51281d0"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a47743a88a6612d3d625e0725f51281d0">dismec::io::model::WeightFileEntry::First</a></div><div class="ttdeci">label_id_t First</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00140">model-io.h:140</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1WeightFileEntry_html_a8b652340340a136a8d8fef015f0043bc"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#a8b652340340a136a8d8fef015f0043bc">dismec::io::model::WeightFileEntry::FileName</a></div><div class="ttdeci">std::string FileName</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00142">model-io.h:142</a></div></div>
<div class="ttc" id="astructdismec_1_1io_1_1model_1_1WeightFileEntry_html_aa85c89073400a857ee0ea1bb756e0a63"><div class="ttname"><a href="structdismec_1_1io_1_1model_1_1WeightFileEntry.html#aa85c89073400a857ee0ea1bb756e0a63">dismec::io::model::WeightFileEntry::Count</a></div><div class="ttdeci">long Count</div><div class="ttdef"><b>Definition:</b> <a href="model-io_8h_source.html#l00141">model-io.h:141</a></div></div>
<div class="ttc" id="astructdismec_1_1model_1_1PartialModelSpec_html"><div class="ttname"><a href="structdismec_1_1model_1_1PartialModelSpec.html">dismec::model::PartialModelSpec</a></div><div class="ttdoc">Specifies how to interpret a weight matrix for a partial model.</div><div class="ttdef"><b>Definition:</b> <a href="model_8h_source.html#l00022">model.h:22</a></div></div>
<div class="ttc" id="asubmodel_8h_html"><div class="ttname"><a href="submodel_8h.html">submodel.h</a></div></div>
<div class="ttc" id="aweights_8h_html"><div class="ttname"><a href="weights_8h.html">weights.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c184e51c84f2c3f0345bbc8a0d75d3e1.html">io</a></li><li class="navelem"><a class="el" href="model-io_8cpp.html">model-io.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
