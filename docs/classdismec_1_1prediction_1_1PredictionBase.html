<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DiSMEC++: dismec::prediction::PredictionBase Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DiSMEC++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classdismec_1_1prediction_1_1PredictionBase.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classdismec_1_1prediction_1_1PredictionBase-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">dismec::prediction::PredictionBase Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Base class for handling predictions.  
 <a href="classdismec_1_1prediction_1_1PredictionBase.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="prediction_2prediction_8h_source.html">prediction.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for dismec::prediction::PredictionBase:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classdismec_1_1prediction_1_1PredictionBase.png" usemap="#dismec::prediction::PredictionBase_map" alt=""/>
  <map id="dismec::prediction::PredictionBase_map" name="dismec::prediction::PredictionBase_map">
<area href="classdismec_1_1parallel_1_1TaskGenerator.html" title="Base class for all parallelized operations." alt="dismec::parallel::TaskGenerator" shape="rect" coords="149,0,437,24"/>
<area href="classdismec_1_1prediction_1_1FullPredictionTaskGenerator.html" alt="dismec::prediction::FullPredictionTaskGenerator" shape="rect" coords="0,112,288,136"/>
<area href="classdismec_1_1prediction_1_1TopKPredictionTaskGenerator.html" alt="dismec::prediction::TopKPredictionTaskGenerator" shape="rect" coords="298,112,586,136"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a935ae599758db8452ca1cc4867e0b4cd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#a935ae599758db8452ca1cc4867e0b4cd">PredictionBase</a> (const <a class="el" href="classdismec_1_1DatasetBase.html">DatasetBase</a> *data, std::shared_ptr&lt; const <a class="el" href="classdismec_1_1model_1_1Model.html">Model</a> &gt; model)</td></tr>
<tr class="memdesc:a935ae599758db8452ca1cc4867e0b4cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor, checks that <code>data</code> and <code>model</code> are compatible.  <a href="classdismec_1_1prediction_1_1PredictionBase.html#a935ae599758db8452ca1cc4867e0b4cd">More...</a><br /></td></tr>
<tr class="separator:a935ae599758db8452ca1cc4867e0b4cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classdismec_1_1parallel_1_1TaskGenerator')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html">dismec::parallel::TaskGenerator</a></td></tr>
<tr class="memitem:a4007397fba3ae35af4eff9db6bab976b inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a4007397fba3ae35af4eff9db6bab976b">~TaskGenerator</a> ()=default</td></tr>
<tr class="separator:a4007397fba3ae35af4eff9db6bab976b inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a645d479700997b972c9cf6335573e3ae inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memItemLeft" align="right" valign="top">virtual long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a645d479700997b972c9cf6335573e3ae">num_tasks</a> () const =0</td></tr>
<tr class="separator:a645d479700997b972c9cf6335573e3ae inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56a517d8f454ae0a0983187136b03a16 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a56a517d8f454ae0a0983187136b03a16">run_tasks</a> (long begin, long end, <a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a8c4bde2cc1e5067414ade10eee7f8ed2">thread_id_t</a> thread_id)=0</td></tr>
<tr class="separator:a56a517d8f454ae0a0983187136b03a16 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e4ef4591ee8fe12ae7f02d557c3b3b1 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a5e4ef4591ee8fe12ae7f02d557c3b3b1">prepare</a> (long num_threads, long chunk_size)</td></tr>
<tr class="memdesc:a5e4ef4591ee8fe12ae7f02d557c3b3b1 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called to notify the <code><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html" title="Base class for all parallelized operations.">TaskGenerator</a></code> about the number of threads.  <a href="classdismec_1_1parallel_1_1TaskGenerator.html#a5e4ef4591ee8fe12ae7f02d557c3b3b1">More...</a><br /></td></tr>
<tr class="separator:a5e4ef4591ee8fe12ae7f02d557c3b3b1 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b39eff24298ad156411c9cd6418d979 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a3b39eff24298ad156411c9cd6418d979">finalize</a> ()</td></tr>
<tr class="memdesc:a3b39eff24298ad156411c9cd6418d979 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called after all threads have finished their tasks.  <a href="classdismec_1_1parallel_1_1TaskGenerator.html#a3b39eff24298ad156411c9cd6418d979">More...</a><br /></td></tr>
<tr class="separator:a3b39eff24298ad156411c9cd6418d979 inherit pub_methods_classdismec_1_1parallel_1_1TaskGenerator"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:aea71fd16d3d7272856efe89c233df7b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#aea71fd16d3d7272856efe89c233df7b5">make_thread_local_features</a> (long num_threads)</td></tr>
<tr class="separator:aea71fd16d3d7272856efe89c233df7b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70a4e9644e08a4e5ac6e9098dfbad13f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#a70a4e9644e08a4e5ac6e9098dfbad13f">init_thread</a> (<a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a8c4bde2cc1e5067414ade10eee7f8ed2">thread_id_t</a> thread_id) final</td></tr>
<tr class="memdesc:a70a4e9644e08a4e5ac6e9098dfbad13f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called once a thread has spun up, but before it runs its first task.  <a href="classdismec_1_1prediction_1_1PredictionBase.html#a70a4e9644e08a4e5ac6e9098dfbad13f">More...</a><br /></td></tr>
<tr class="separator:a70a4e9644e08a4e5ac6e9098dfbad13f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a404da779cfff39976c84ea25495ccb18"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#a404da779cfff39976c84ea25495ccb18">do_prediction</a> (long begin, long end, <a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a8c4bde2cc1e5067414ade10eee7f8ed2">thread_id_t</a> thread_id, Eigen::Ref&lt; <a class="el" href="namespacedismec.html#aa5bb6a768e148994d5f74ba63aa756c8">PredictionMatrix</a> &gt; target)</td></tr>
<tr class="memdesc:a404da779cfff39976c84ea25495ccb18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Predicts the scores for a subset of the instances given by the half-open interval <code>[begin, end)</code>.  <a href="classdismec_1_1prediction_1_1PredictionBase.html#a404da779cfff39976c84ea25495ccb18">More...</a><br /></td></tr>
<tr class="separator:a404da779cfff39976c84ea25495ccb18"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ac65589e206766f53045c1eac5931ad44"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classdismec_1_1DatasetBase.html">DatasetBase</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#ac65589e206766f53045c1eac5931ad44">m_Data</a></td></tr>
<tr class="memdesc:ac65589e206766f53045c1eac5931ad44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data on which the prediction is run.  <a href="classdismec_1_1prediction_1_1PredictionBase.html#ac65589e206766f53045c1eac5931ad44">More...</a><br /></td></tr>
<tr class="separator:ac65589e206766f53045c1eac5931ad44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac3f73e2d332997cef7f20a6e445a5fa"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; const <a class="el" href="classdismec_1_1model_1_1Model.html">Model</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#aac3f73e2d332997cef7f20a6e445a5fa">m_Model</a></td></tr>
<tr class="memdesc:aac3f73e2d332997cef7f20a6e445a5fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Model (possibly partial) for which prediction is run.  <a href="classdismec_1_1prediction_1_1PredictionBase.html#aac3f73e2d332997cef7f20a6e445a5fa">More...</a><br /></td></tr>
<tr class="separator:aac3f73e2d332997cef7f20a6e445a5fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ae747cabfeed6b0a532aaaaad740d77b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classdismec_1_1parallel_1_1NUMAReplicator.html">parallel::NUMAReplicator</a>&lt; const <a class="el" href="namespacedismec.html#ae3c26b478ad2872cccb3848d2fcefe5f">GenericFeatureMatrix</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#ae747cabfeed6b0a532aaaaad740d77b5">m_FeatureReplicator</a></td></tr>
<tr class="memdesc:ae747cabfeed6b0a532aaaaad740d77b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <code>NUMAReplicator</code> that generates NUMA-local copies for the feature matrices.  <a href="classdismec_1_1prediction_1_1PredictionBase.html#ae747cabfeed6b0a532aaaaad740d77b5">More...</a><br /></td></tr>
<tr class="separator:ae747cabfeed6b0a532aaaaad740d77b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7608a12ee3b093eae9e891815c7942a"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::shared_ptr&lt; const <a class="el" href="namespacedismec.html#ae3c26b478ad2872cccb3848d2fcefe5f">GenericFeatureMatrix</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#aa7608a12ee3b093eae9e891815c7942a">m_ThreadLocalFeatures</a></td></tr>
<tr class="separator:aa7608a12ee3b093eae9e891815c7942a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_types_classdismec_1_1parallel_1_1TaskGenerator"><td colspan="2" onclick="javascript:toggleInherit('pub_types_classdismec_1_1parallel_1_1TaskGenerator')"><img src="closed.png" alt="-"/>&#160;Public Types inherited from <a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html">dismec::parallel::TaskGenerator</a></td></tr>
<tr class="memitem:a8c4bde2cc1e5067414ade10eee7f8ed2 inherit pub_types_classdismec_1_1parallel_1_1TaskGenerator"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a8c4bde2cc1e5067414ade10eee7f8ed2">thread_id_t</a> = <a class="el" href="classdismec_1_1parallel_1_1thread__id__t.html">dismec::parallel::thread_id_t</a></td></tr>
<tr class="separator:a8c4bde2cc1e5067414ade10eee7f8ed2 inherit pub_types_classdismec_1_1parallel_1_1TaskGenerator"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Base class for handling predictions. </p>
<p>This class manages the dataset and model used for batch prediction. It ensures the features are replicated across the NUMA nodes. Batch-prediction is a difficult process, because:</p><ol type="1">
<li>The model may be too large to fit into RAM at once</li>
<li>The predicted scores may be too many to fit into RAM at once. There are several ways how this could be countered. If only the model is too large, then one may load the model piece by piece, and predict sequentially for the different parts of the model. Parallelism can be achieved by having different threads handle different examples. Such a process is implemented in <code><a class="el" href="classdismec_1_1prediction_1_1FullPredictionTaskGenerator.html">FullPredictionTaskGenerator</a></code>.</li>
</ol>
<p>However, if the predictions cannot be stored in memory, things become more complicated. For many applications, though, one does not actually need the full prediction scores vector, because the prediction is interpreted as a ranking task and only the top-k entries are of relevance. In that case, the top-k reduction can be performed as an accumulation step over the different partial models, and the full score vector never need be stored. This type of prediction is realized through <code><a class="el" href="classdismec_1_1prediction_1_1TopKPredictionTaskGenerator.html">TopKPredictionTaskGenerator</a></code>. </p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8h_source.html#l00034">34</a> of file <a class="el" href="prediction_2prediction_8h_source.html">prediction.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a935ae599758db8452ca1cc4867e0b4cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a935ae599758db8452ca1cc4867e0b4cd">&#9670;&nbsp;</a></span>PredictionBase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PredictionBase::PredictionBase </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classdismec_1_1DatasetBase.html">DatasetBase</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; const <a class="el" href="classdismec_1_1model_1_1Model.html">Model</a> &gt;&#160;</td>
          <td class="paramname"><em>model</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor, checks that <code>data</code> and <code>model</code> are compatible. </p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8cpp_source.html#l00017">17</a> of file <a class="el" href="prediction_2prediction_8cpp_source.html">prediction.cpp</a>.</p>

<p class="reference">References <a class="el" href="prediction_2prediction_8h_source.html#l00041">m_Model</a>, <a class="el" href="data_8cpp_source.html#l00048">dismec::DatasetBase::num_features()</a>, and <a class="el" href="classdismec_1_1DatasetBase.html#add81f95236dcf0bdbfefd4b8976a80ca">dismec::DatasetBase::num_labels()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a404da779cfff39976c84ea25495ccb18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a404da779cfff39976c84ea25495ccb18">&#9670;&nbsp;</a></span>do_prediction()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PredictionBase::do_prediction </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a8c4bde2cc1e5067414ade10eee7f8ed2">thread_id_t</a>&#160;</td>
          <td class="paramname"><em>thread_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::Ref&lt; <a class="el" href="namespacedismec.html#aa5bb6a768e148994d5f74ba63aa756c8">PredictionMatrix</a> &gt;&#160;</td>
          <td class="paramname"><em>target</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Predicts the scores for a subset of the instances given by the half-open interval <code>[begin, end)</code>. </p>
<p>This function is to be used by derived classes to generate the (partial) score predictions. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">begin</td><td>The index of the first instance for which prediction will be performed. </td></tr>
    <tr><td class="paramname">end</td><td>The index past the last instance for which prediction will be performed. </td></tr>
    <tr><td class="paramname">thread_id</td><td>Index of the thread which performs the prediction. This argument is needed so the function knows which feature replication to use for optimal performance. </td></tr>
    <tr><td class="paramname">target</td><td>Reference to the target array in which the predictions will be saved. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::logic_error</td><td>if the shape of <code>target</code> is not compatible. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8cpp_source.html#l00051">51</a> of file <a class="el" href="prediction_2prediction_8cpp_source.html">prediction.cpp</a>.</p>

<p class="reference">References <a class="el" href="prediction_2prediction_8h_source.html#l00041">m_Model</a>, <a class="el" href="prediction_2prediction_8h_source.html#l00067">m_ThreadLocalFeatures</a>, <a class="el" href="prediction_2prediction_8cpp_source.html#l00046">anonymous_namespace{prediction.cpp}::make_matrix()</a>, <a class="el" href="opaque__int_8h_source.html#l00032">dismec::opaque_int_type&lt; Tag, T &gt;::to_index()</a>, and <a class="el" href="eigen__generic_8h_source.html#l00095">dismec::types::visit()</a>.</p>

<p class="reference">Referenced by <a class="el" href="prediction_2prediction_8cpp_source.html#l00070">dismec::prediction::FullPredictionTaskGenerator::run_tasks()</a>, and <a class="el" href="prediction_2prediction_8cpp_source.html#l00133">dismec::prediction::TopKPredictionTaskGenerator::run_tasks()</a>.</p>

</div>
</div>
<a id="a70a4e9644e08a4e5ac6e9098dfbad13f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70a4e9644e08a4e5ac6e9098dfbad13f">&#9670;&nbsp;</a></span>init_thread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PredictionBase::init_thread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classdismec_1_1parallel_1_1thread__id__t.html">parallel::thread_id_t</a>&#160;</td>
          <td class="paramname"><em>thread_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">final</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called once a thread has spun up, but before it runs its first task. </p>
<p>This function is called from inside the thread that also will run the tasks. </p>

<p>Reimplemented from <a class="el" href="classdismec_1_1parallel_1_1TaskGenerator.html#a6fce694c4fec7283bde38b380b9d8e09">dismec::parallel::TaskGenerator</a>.</p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8cpp_source.html#l00038">38</a> of file <a class="el" href="prediction_2prediction_8cpp_source.html">prediction.cpp</a>.</p>

<p class="reference">References <a class="el" href="prediction_2prediction_8h_source.html#l00063">m_FeatureReplicator</a>, <a class="el" href="prediction_2prediction_8h_source.html#l00067">m_ThreadLocalFeatures</a>, and <a class="el" href="opaque__int_8h_source.html#l00032">dismec::opaque_int_type&lt; Tag, T &gt;::to_index()</a>.</p>

</div>
</div>
<a id="aea71fd16d3d7272856efe89c233df7b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea71fd16d3d7272856efe89c233df7b5">&#9670;&nbsp;</a></span>make_thread_local_features()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PredictionBase::make_thread_local_features </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>num_threads</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This function resizes the internal thread local feature buffer to correspond to the number of threads. This needs to be called before any call to <code><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html#a70a4e9644e08a4e5ac6e9098dfbad13f" title="Called once a thread has spun up, but before it runs its first task.">init_thread()</a></code>. </p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8cpp_source.html#l00034">34</a> of file <a class="el" href="prediction_2prediction_8cpp_source.html">prediction.cpp</a>.</p>

<p class="reference">References <a class="el" href="prediction_2prediction_8h_source.html#l00067">m_ThreadLocalFeatures</a>.</p>

<p class="reference">Referenced by <a class="el" href="prediction_2prediction_8cpp_source.html#l00075">dismec::prediction::FullPredictionTaskGenerator::prepare()</a>, and <a class="el" href="prediction_2prediction_8cpp_source.html#l00103">dismec::prediction::TopKPredictionTaskGenerator::prepare()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ac65589e206766f53045c1eac5931ad44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac65589e206766f53045c1eac5931ad44">&#9670;&nbsp;</a></span>m_Data</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classdismec_1_1DatasetBase.html">DatasetBase</a>* dismec::prediction::PredictionBase::m_Data</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Data on which the prediction is run. </p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8h_source.html#l00040">40</a> of file <a class="el" href="prediction_2prediction_8h_source.html">prediction.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="prediction_2prediction_8cpp_source.html#l00065">dismec::prediction::FullPredictionTaskGenerator::num_tasks()</a>, and <a class="el" href="prediction_2prediction_8cpp_source.html#l00099">dismec::prediction::TopKPredictionTaskGenerator::num_tasks()</a>.</p>

</div>
</div>
<a id="ae747cabfeed6b0a532aaaaad740d77b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae747cabfeed6b0a532aaaaad740d77b5">&#9670;&nbsp;</a></span>m_FeatureReplicator</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classdismec_1_1parallel_1_1NUMAReplicator.html">parallel::NUMAReplicator</a>&lt;const <a class="el" href="namespacedismec.html#ae3c26b478ad2872cccb3848d2fcefe5f">GenericFeatureMatrix</a>&gt; dismec::prediction::PredictionBase::m_FeatureReplicator</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The <code>NUMAReplicator</code> that generates NUMA-local copies for the feature matrices. </p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8h_source.html#l00063">63</a> of file <a class="el" href="prediction_2prediction_8h_source.html">prediction.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="prediction_2prediction_8cpp_source.html#l00038">init_thread()</a>.</p>

</div>
</div>
<a id="aac3f73e2d332997cef7f20a6e445a5fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac3f73e2d332997cef7f20a6e445a5fa">&#9670;&nbsp;</a></span>m_Model</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;const <a class="el" href="classdismec_1_1model_1_1Model.html">Model</a>&gt; dismec::prediction::PredictionBase::m_Model</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Model (possibly partial) for which prediction is run. </p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8h_source.html#l00041">41</a> of file <a class="el" href="prediction_2prediction_8h_source.html">prediction.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="prediction_2prediction_8cpp_source.html#l00051">do_prediction()</a>, <a class="el" href="prediction_2prediction_8cpp_source.html#l00017">PredictionBase()</a>, <a class="el" href="prediction_2prediction_8cpp_source.html#l00103">dismec::prediction::TopKPredictionTaskGenerator::prepare()</a>, <a class="el" href="prediction_2prediction_8cpp_source.html#l00133">dismec::prediction::TopKPredictionTaskGenerator::run_tasks()</a>, and <a class="el" href="prediction_2prediction_8cpp_source.html#l00210">dismec::prediction::TopKPredictionTaskGenerator::update_model()</a>.</p>

</div>
</div>
<a id="aa7608a12ee3b093eae9e891815c7942a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7608a12ee3b093eae9e891815c7942a">&#9670;&nbsp;</a></span>m_ThreadLocalFeatures</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::shared_ptr&lt;const <a class="el" href="namespacedismec.html#ae3c26b478ad2872cccb3848d2fcefe5f">GenericFeatureMatrix</a>&gt; &gt; dismec::prediction::PredictionBase::m_ThreadLocalFeatures</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Vector that stores references (as <code>shared_ptr</code>) to the NUMA-local copies of the feature matrices, in such a way that the correct copy can be found by indexing with the thread id. </p>

<p class="definition">Definition at line <a class="el" href="prediction_2prediction_8h_source.html#l00067">67</a> of file <a class="el" href="prediction_2prediction_8h_source.html">prediction.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="prediction_2prediction_8cpp_source.html#l00051">do_prediction()</a>, <a class="el" href="prediction_2prediction_8cpp_source.html#l00038">init_thread()</a>, and <a class="el" href="prediction_2prediction_8cpp_source.html#l00034">make_thread_local_features()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/prediction/<a class="el" href="prediction_2prediction_8h_source.html">prediction.h</a></li>
<li>src/prediction/<a class="el" href="prediction_2prediction_8cpp_source.html">prediction.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacedismec.html">dismec</a></li><li class="navelem"><a class="el" href="namespacedismec_1_1prediction.html">prediction</a></li><li class="navelem"><a class="el" href="classdismec_1_1prediction_1_1PredictionBase.html">PredictionBase</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
